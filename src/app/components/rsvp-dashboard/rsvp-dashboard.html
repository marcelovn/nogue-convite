@if (confirmDeleteId()) {
  <app-confirm-dialog
    title="Excluir convite"
    message="Tem certeza que deseja excluir este convite? Esta aÃ§Ã£o nÃ£o pode ser desfeita."
    confirmLabel="Excluir"
    cancelLabel="Cancelar"
    [danger]="true"
    (confirmed)="confirmDelete()"
    (cancelled)="confirmDeleteId.set(null)" />
}

@if (confirmClearId()) {
  <app-confirm-dialog
    title="Zerar respostas"
    message="Tem certeza que deseja limpar todas as respostas deste convite? Esta aÃ§Ã£o nÃ£o pode ser desfeita."
    confirmLabel="Zerar"
    cancelLabel="Cancelar"
    [danger]="true"
    (confirmed)="confirmClear()"
    (cancelled)="confirmClearId.set(null)" />
}

<div class="dashboard-container animate-fade-in">
  <!-- Perfil -->
  <section class="profile-section">
    @if (isLoading()) {
      <div class="profile-card card-base">
        <div class="profile-header">
          <div class="profile-info">
            <div class="skeleton-text-lg" style="width: 55%; margin-bottom: 0.4rem"></div>
            <div class="skeleton-text-sm" style="width: 40%"></div>
          </div>
          <div class="skeleton-btn" style="width: 70px"></div>
          <div class="skeleton-btn" style="width: 50px"></div>
        </div>
      </div>
    } @else {
      <div class="profile-card card-base">
        <div class="profile-header">
          <div class="profile-info">
            <h2>OlÃ¡, {{ getUserName() }}</h2>
            <p>{{ authService.currentUser()?.email }}</p>
          </div>
          <span class="profile-badge">{{ cards().length }} {{ cards().length === 1 ? 'convite' : 'convites' }}</span>
          <button class="btn btn-danger" (click)="logout()">Sair</button>
        </div>
      </div>
    }
  </section>

  <!-- Convites -->
  <header class="dashboard-header">
    <div>
      <h1>Meus convites</h1>
    </div>
    <button class="btn btn-primary" (click)="createNew()">Novo convite</button>
  </header>

  @if (isLoading()) {
    <!-- Skeleton Cards -->
    <div class="cards-grid">
      @for (i of [1, 2, 3]; track i) {
        <div class="dashboard-card card-base skeleton-card">
          <div class="card-header">
            <div class="skeleton-text-lg" style="width: 65%"></div>
            <div class="skeleton-text-sm" style="width: 40%; margin-top: 0.5rem"></div>
          </div>
          <div class="card-info" style="margin-top: 1rem">
            <div class="skeleton-text" style="width: 50%"></div>
          </div>
          <div class="stats-bar" style="margin-top: 1rem">
            <div style="text-align: center">
              <div class="skeleton-text-lg" style="width: 30px; margin: 0 auto 0.3rem"></div>
              <div class="skeleton-text-sm" style="width: 80px; margin: 0 auto"></div>
            </div>
          </div>
          <div class="card-actions" style="margin-top: 1rem">
            <div class="skeleton-btn" style="width: 45px"></div>
            <div class="skeleton-btn" style="width: 75px"></div>
            <div class="skeleton-btn" style="width: 45px"></div>
            <div class="skeleton-btn" style="width: 50px"></div>
            <div class="skeleton-btn" style="width: 60px"></div>
          </div>
        </div>
      }
    </div>
  } @else if (cards().length === 0) {
    <div class="empty-state card-base">
      <span class="empty-icon">ðŸ“«</span>
      <h2>Nenhum convite criado</h2>
      <p>Crie seu primeiro convite interativo</p>
      <button class="btn btn-primary" (click)="createNew()">Criar convite</button>
    </div>
  } @else {
    <div class="cards-grid">
      @for (card of cards(); track card.id) {
        @let stats = getStats(card.id!);
        <div class="dashboard-card card-base">
          <div class="card-header">
            <h3>{{ card.title }}</h3>
            <span class="card-date">
              {{ card.createdAt ? 'Criado em ' + (card.createdAt | date:'dd/MM/yyyy') : '' }}
            </span>
          </div>

          <div class="card-info">
            <p><strong>Enviado por:</strong> {{ card.senderName }}</p>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <span class="stat-number stat-yes">{{ stats.yes }}</span>
              <span class="stat-label">ComparecerÃ£o</span>
            </div>
          </div>

          <div class="card-actions">
            <button class="btn btn-ghost" (click)="viewCard(card.id!)">Ver</button>
            <button class="btn btn-ghost btn-whatsapp-sm" (click)="shareWhatsApp(card)">WhatsApp</button>
            <button class="btn btn-ghost" (click)="copyLink(card.id!)">
              {{ linkCopied() === card.id ? 'âœ“ Copiado' : 'Link' }}
            </button>
            <button class="btn btn-ghost btn-warning" (click)="clearResponses(card.id!)">Zerar</button>
            <button class="btn btn-ghost btn-danger" (click)="deleteCard(card.id!)">Excluir</button>
          </div>
        </div>
      }
    </div>
  }
</div>

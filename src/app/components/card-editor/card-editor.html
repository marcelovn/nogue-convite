<div class="editor-container">
  <header class="editor-header">
    <h1>‚ú® Criar Convite Irrecus√°vel</h1>
  </header>

  <!-- Progress Steps -->
  <div class="steps-indicator">
    <div class="step" [class.active]="currentStep() >= 1" [class.completed]="currentStep() > 1">
      <span class="step-number">1</span>
      <span class="step-label">Informa√ß√µes</span>
    </div>
    <div class="step-line" [class.active]="currentStep() > 1"></div>
    <div class="step" [class.active]="currentStep() >= 2" [class.completed]="currentStep() > 2">
      <span class="step-number">2</span>
      <span class="step-label">Visual</span>
    </div>
    <div class="step-line" [class.active]="currentStep() > 2"></div>
    <div class="step" [class.active]="currentStep() >= 3">
      <span class="step-number">3</span>
      <span class="step-label">Mec√¢nica</span>
    </div>
  </div>

  <!-- Step 1: Info -->
  @if (currentStep() === 1) {
    <section class="editor-step card-base">
      <h2 class="section-title">üìù Informa√ß√µes do Convite</h2>

      <div class="form-group">
        <label for="senderName">Seu nome</label>
        <input
          id="senderName"
          type="text"
          placeholder="Ex: Jo√£o"
          [ngModel]="senderName()"
          (ngModelChange)="senderName.set($event)" />
      </div>

      <div class="form-group">
        <label for="cardTitle">T√≠tulo do Convite</label>
        <input
          id="cardTitle"
          type="text"
          placeholder="Ex: Voc√™ est√° convidado! üéâ"
          [ngModel]="cardTitle()"
          (ngModelChange)="cardTitle.set($event)" />
      </div>

      <div class="form-group">
        <label for="cardMessage">Mensagem especial</label>
        <textarea
          id="cardMessage"
          rows="4"
          placeholder="Ex: Venha celebrar esse momento especial conosco!"
          [ngModel]="cardMessage()"
          (ngModelChange)="cardMessage.set($event)"></textarea>
      </div>

      <!-- Photo Upload -->
      <div class="form-group">
        <label for="photoInput">üì∏ Adicionar Foto (opcional)</label>
        <div class="file-input-wrapper">
          <input
            id="photoInput"
            type="file"
            accept="image/*"
            (change)="onPhotoSelected($event)" />
          <span class="file-input-label">
            @if (photoFile()) {
              {{ photoFile()!.name }}
            } @else {
              Clique para selecionar uma foto
            }
          </span>
        </div>
        @if (photoPreview()) {
          <div class="media-preview">
            <img [src]="photoPreview()!" alt="Preview da foto" />
            <button type="button" class="btn-clear" (click)="clearPhoto()">‚úï Remover</button>
          </div>
        }
      </div>

      <!-- Music Upload -->
      <div class="form-group">
        <label for="musicInput">üéµ Adicionar M√∫sica (opcional)</label>
        <div class="file-input-wrapper">
          <input
            id="musicInput"
            type="file"
            accept="audio/*"
            (change)="onMusicSelected($event)" />
          <span class="file-input-label">
            @if (musicFile()) {
              {{ musicFile()!.name }}
            } @else {
              Clique para selecionar uma m√∫sica
            }
          </span>
        </div>
        @if (musicFile()) {
          <div class="music-selected">
            <span>üéµ {{ musicFile()!.name }}</span>
            <button type="button" class="btn-clear" (click)="clearMusic()">‚úï Remover</button>
          </div>
        }
      </div>

      <div class="step-actions">
        <span></span>
        <button class="btn btn-primary" (click)="nextStep()">Pr√≥ximo ‚Üí</button>
      </div>
    </section>
  }

  <!-- Step 2: Visual -->
  @if (currentStep() === 2) {
    <section class="editor-step card-base">
      <app-theme-selector (themeChanged)="onThemeChanged($event)" />
      <app-color-scheme (schemeChanged)="onSchemeChanged($event)" />

      <div class="step-actions">
        <button class="btn btn-secondary" (click)="prevStep()">‚Üê Voltar</button>
        <button class="btn btn-primary" (click)="nextStep()">Pr√≥ximo ‚Üí</button>
      </div>
    </section>
  }

  <!-- Step 3: Mechanic -->
  @if (currentStep() === 3) {
    <section class="editor-step card-base">
      <h2 class="section-title">üéÆ Mec√¢nica do Bot√£o "N√£o"</h2>
      <p class="section-subtitle">Escolha como fazer com que a pessoa N√ÉO conseguir rejeitar o convite!</p>

      <div class="mechanic-grid">
        @for (mech of mechanics; track mech.id) {
          <button
            class="mechanic-card"
            [class.selected]="selectedMechanic() === mech.id"
            (click)="selectedMechanic.set($any(mech.id))">
            <span class="mechanic-icon">
              @switch (mech.id) {
                @case ('teleporting') { üèÉ }
                @case ('growing-yes') { üìà }
                @case ('multiplying-yes') { ‚ú® }
                @case ('shrinking-no') { üîç }
              }
            </span>
            <span class="mechanic-label">{{ mech.label }}</span>
            <span class="mechanic-desc">{{ mech.description }}</span>
          </button>
        }
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" (click)="prevStep()" [disabled]="isLoading()">‚Üê Voltar</button>
        <button class="btn btn-secondary" (click)="previewCard()" [disabled]="isLoading()">üëÅ Preview</button>
        <button class="btn btn-whatsapp" (click)="saveAndShareWhatsApp()" [disabled]="isLoading()">
          @if (isLoading()) {
            <span class="spinner"></span>
          } @else {
            üì≤ WhatsApp
          }
        </button>
        <button class="btn btn-primary" (click)="saveAndShare()" [disabled]="isLoading()">
          @if (isLoading()) {
            <span class="spinner"></span>
          } @else {
            ‚ú® Criar
          }
        </button>
      </div>
    </section>
  }

  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="loading-card">
        <div class="spinner-large"></div>
        <p>Criando seu convite irrecus√°vel...</p>
      </div>
    </div>
  }
</div>
